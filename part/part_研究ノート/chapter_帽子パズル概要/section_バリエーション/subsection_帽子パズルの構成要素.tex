\documentclass[C:/souji/all-note/note]{subfiles}

\begin{document}

帽子パズルには様々なバリエーションがある.
今なお新しい設定のパズルが生まれている中で,
網羅的にまとめることは難しいとは思います.
それでも研究時点での成果として,
帽子パズル的な要素をもつパズルの種類や特徴についてまとめていきます.

他のパズルと比べるため,
一番シンプルなHardin-Taylorの帽子パズルを再掲します.

\begin{re-puzzle}{puzzle:hat-Hardin-Taylor}
  看守があるゲームをするために2人の囚人を同じ部屋に入れ,
  帽子を1人に1つずつ被せます.
  その帽子は黒白どちらかの色で塗られています.
  囚人2人はそれぞれ自分が被っている帽子の色は分かりませんが,
  もう1人の囚人の帽子の色は見えています.
  また部屋に入ってからは互いに一切のコミュニケーションが取れません.
  この状態で帽子の色のどちらかのみを,
  つまり「黒」か「白」のみを2人同時に発言させ,
  その発言とその発言者が被っている帽子の色が一致していれば正解となり,
  そんな正解者が1人でもいれば囚人側の勝利として2人とも釈放されます.
  もし2人とも不正解ならば囚人側の敗北として2人とも処刑されます.
  当たり前ですが看守がどのように帽子を被せるかは,
  囚人たちは入室するまで知りません.
  このゲームのルールや勝利条件については,
  部屋に入る前に囚人たちに伝えられ,
  ゲーム開始までに2人で戦略を相談することが可能です.
  このとき入室後にどのように帽子を被せられても,
  常に囚人側が勝利する戦略は存在するでしょうか？
\end{re-puzzle}

たとえば以下のようなパズルがあります.

\begin{puzzle}[]
  \label{puzzle:hat-Gardner-simultaneous}
  看守があるゲームをするために3人の囚人を同じ部屋に入れたあと,
  以下のルールを説明します.
  そのルールとは,
  \begin{enumerate}
    \item
      これから全員に黒白どちらかの色の帽子を被せ,
      自分の帽子の色は分からないが自分以外の全ての帽子は見える.
    \item
      帽子を被せたあと一度他の全ての帽子を見てもらい黒色が1つでも見えたら手を挙げる.
    \item
      そのあと自分の色が何であるかを考えさせたあとに,
      全員同時に黒白どちらかの色か「分からない」のいずれかを発言させ,
      そのさい自分以外の発言は聞こえる.
    \item
      もし1人でも「分からない」と発言すれば,
      もう一度考えさせたあとに,
      同じように３択の中から発言させる.
      これを繰り返していき,
      その中で自分の帽子の色を言い当てることができれば,
      その囚人は釈放され,
      間違った色を発言すれば処刑される.
  \end{enumerate}
  というものです.
  また囚人は正直なので自分の色が分かっているのに「分からない」とは発言しないものとします. \\
  ルール説明後看守は全ての囚人に黒色の帽子を被せました.
  すると全員手を挙げました.
  そして発言させると全員「分からない」と答えました.
  しかしもう一度発言させると全員「黒」と発言し釈放されました.
  なぜどの囚人も自分の色が分かったのでしょうか？
\end{puzzle}

\begin{answer}
  3人の囚人たちを$a,b,c$とおく.
  まず囚人$a$の立場にたって考えます.
  1回目の発言を終えたあと囚人$a$は自分が白色を被っていると考えると,
  見えている帽子の色とあわせて今自分たちの帽子の色の様子は以下のようになっていると考えるはずです.
  \begin{table}[H]
    \begin{center}
      \begin{tabular}{c|c|c}
            $a$ & $b$ & $c$ \\ \hline
            白    & 黒    & 黒
      \end{tabular}
    \end{center}
  \end{table}
  こういう被せ方でも最初に全員が手を挙げたことに矛盾はしません. \\
  そして囚人$a$は囚人$b$の立場にたって考えてみます.
  すると囚人$c$が手を挙げたことと,
  $b$からは$a$の白と$c$の黒が見えていることから,
  囚人$b$は自分が黒を被っているとわかるはずです.
  しかし1回目の発言で$b$は「分からない」と発言したことから,
  囚人$a$は自身が白色でない,
  つまり自分は黒色を被っていると分かり,
  2回目の発言で黒を発言して正解しました.
  $a$以外の囚人も1回目の発言後に同様に考えたことで自分が黒を被っていると分かりました.
\end{answer}

そもそも問題の質問の仕方が違うという点はさておき,
このパズルとPuzzle \ref{hat-Hardin-Taylor}との違いをまとめると,
\begin{enumerate}
  \item 囚人が3人になっていること.
  \item 色以外に「分からない」という発言もできること.
  \item 二度以上発言できること.
  \item 自分以外の発言という情報も色の推測に使うことができること.
  \item 「手を挙げさせる」ルールによって,
    自分以外の囚人から見て黒が見えるかどうかを知ることができること.
\end{enumerate}
などがありますが,
私が考える最大の違いは,
囚人たちはチームでゲームに挑むのではなく,
あくまで個人で挑む点です.
協力することができないという言い方もできます.

このパズルは以下のように変えても同じように考え方で解くことができます.
ゲームルールにおいて変えた部分はテキストの色を赤色に変更しています.

\begin{puzzle}[]
  \label{puzzle:hat-Gardner-order}
  看守があるゲームをするために3人の囚人$a,b,c$を同じ部屋に入れたあと,
  以下のルールを説明します.
  そのルールとは,
  \begin{enumerate}
    \item
      これから全員に黒白どちらかの色の帽子を被せ,
      自分の帽子の色は分からないが自分以外の全ての帽子は見える.
    \item
      帽子を被せたあと一度他の全ての帽子を見てもらい黒色が1つでも見えたら手を挙げる.
    \item
      そのあと自分の色が何であるかを考えさせたあとに,
      {\color{red} $a,b,c$の順に}黒白どちらかの色か「分からない」のいずれかを発言させ,
      そのさい自分以外の発言は聞こえる.
    \item
      もし1人でも「分からない」と発言すれば,
      もう一度考えさせたあとに,
      同じように{\color{red} 再度$a,b,c$の順に}３択の中から発言させる.
      これを繰り返していき,
      その中で自分の帽子の色を言い当てることができれば,
      その囚人は釈放され,
      間違った色を発言すれば処刑される.
  \end{enumerate}
  というものです.
  また囚人は自分の色が分かっているのに「分からない」とは発言しないものとします. \\
  ルール説明後看守は全ての囚人に黒色の帽子を被せました.
  すると全員手を挙げました.
  最初の発言では3人は「分からない」と答えましたが,
  2度目の発言が回ってきた囚人$a$は「黒」と発言して正解し釈放されました.
  なぜ囚人$a$は自分の色が分かったのでしょうか？
\end{puzzle}

またこの後$b,c$も順に発言させても$a$と同じように考えることで,
先ほどのパズル同様正解することができます.

このパズルとPuzzle \ref{puzzle:hat-Gardner-simultaneous}との違いは発言が同時ではなく順番になった点だけです.

もう1つ囚人たちが協力しないパズルの例を挙げます.
Puzzle \ref{puzzle:hat-Gardner-order}との違いを分かりやすくするために,
こちらもPuzzle \ref{puzzle:hat-Gardner-order}と異なる部分はテキストの色を赤色に変更しました.

\begin{puzzle}[]
  \label{puzzle:hat-Dirac}
  看守があるゲームをするために3人の囚人$a,b,c$を同じ部屋に入れたあと,
  以下のルールを説明します.
  そのルールとは,
  \begin{enumerate}
    \item
      {\color{red} これから5つある帽子のうち1つずつを囚人全員に被せていくが,
      5つのうち2つは白,
      3つは黒色になっている.
      どの囚人もどの帽子を使わなかったのか},
      自分がどの帽子を被っているのか知ることはできないが,
      自分以外の囚人がどの帽子を被っているかは見える.
    \item
      そのあと自分の色が何であるかを考えさせたあとに,
      $a,b,c$の順に黒白どちらかの色か「分からない」のいずれかを発言させ,
      そのさい自分以外の発言は聞こえる.
    \item
      もし1人でも「分からない」と発言すれば,
      もう一度考えさせたあとに,
      同じように再度$a,b,c$の順に３択の中から発言させる.
      これを繰り返していき,
      その中で自分の帽子の色を言い当てることができれば,
      その囚人は釈放され,
      間違った色を発言すれば処刑される.
  \end{enumerate}
  というものです.
  また囚人は自分の色が分かっているのに「分からない」とは発言しないものとします. \\
  $a,b$は順番に「分からない」と答えましたが,
  それを聞いた$c$は「黒」と発言して正解し釈放されました.
  なぜ囚人$c$は自分の色が分かったのでしょうか？
\end{puzzle}

\begin{answer}
  囚人$c$は,
  まず$a$が「分からない」と答えたことから$b$と自分の帽子の組み合わせの候補が以下のように絞れます.
  \begin{table}[H]
    \begin{center}
      \begin{tabular}{c|c}
            $b$ & $c$ \\ \hline
            黒    & 黒  \\
            黒    & 白  \\
            白    & 黒  \\
      \end{tabular}
    \end{center}
  \end{table}
  なぜならもし$b,c$がどちらも白を被っていれば,
  $a$は自分が黒だと分かったはずだからです.
  なのでその可能性は無くなり上記のような組み合わせだけが候補に残ります.
  またこれは$b$も同じことを考えつくことになります. \\
  続けて$b$も「分からない」と発言したことから,
  $c$は自分が黒だと分かります.
  なぜならば$b$も自分（$b$）と$c$は以下の組み合わせしかないと$a$の発言から分かっており,
  そしてもし$c$が白を被っていれば自分が黒を被っていると発言できたはずです.
  しかし分からないと答えたということは,
  $b$から見て$c$は黒を被っていたことになります.
\end{answer}

Puzzle \ref{puzzle:hat-Gardner-simultaneous}とPuzzle \ref{puzzle:hat-Gardner-order}との最大の違いは,
私たち回答者には最後まで全ての囚人が何を被っているかは分からない点でしょうか.
つまりPuzzle \ref{puzzle:hat-Dirac}ではこのあとどれだけ考えても$a,b$が何を被っているかは分かりません.
上記の2つのパズルは問題文の時点で全員が黒を被っていると分かっていました.
色ごとの帽子の個数が囚人たちに分かるというは大きな違いに思えるかもしれませんが,
これは上記2つの「黒が見えたら手を挙げさせる」というものとさして違いはありません.
なぜならこのようなヒントでもって囚人たちにとって自分たちの色の様子の候補を絞っていくための情報という点で違いがないからです.

これらのパズルは説明しやすいように私なりに設定を変えていますが,
Puzzle \ref{puzzle:hat-Dirac}は物理学者の\textbf{Paul Dirac}が考案した可能性があり,
Puzzle \ref{puzzle:hat-Gardner-order}はパズル作家でもあった数学者\textbf{Martin Gardner}がその著作にて紹介したものです.
この情報や証拠となる文献については\SecRef{section:帽子パズルの歴史}で紹介します.
上でも説明したとおりPuzzle \ref{puzzle:hat-Hardin-Taylor}とこれら3つのパズルの最大の違いは,
囚人たちが協力するか・できるかという点にあると考えています.
よって囚人たちが協力する帽子パズルをこれまで通り\textbf{Hardin}-\textbf{Taylor}\textgt{の帽子パズル}と呼ぶことにし,
\index{しゅうじんとぼうしのぱずる@囚人と帽子のパズル!はーでぃんていらーのぼうしぱずる@Hardin-Taylorの帽子パズル}
新たに紹介した囚人たちが協力しない帽子パズルを2人の名前をとって,
\textbf{Dirac}-\textbf{Gardner}\textgt{の帽子パズル}と呼ぶことにしました.
\index{しゅうじんとぼうしのぱずる@囚人と帽子のパズル!でぃらっくがーどなーのぼうしぱずる@Dirac-Gardnerの帽子パズル}

よって私はすべての帽子パズルは囚人が協力するか否かで,
このHardin-Taylorのものか,
Dirac-Gardnerのものかに大別可能だと考えています.

Hardin-Taylorの帽子パズルの方がDirac-Gardnerの帽子パズルよりもシンプルだと感じます.
なぜならば後者では囚人は個人でゲームに挑んでおり,
自分以外の帽子が見えたところでそれだけでは自分の色を推測することは不可能なため,
追加の情報がいくつも必要になるからだと思います.
つまり自分も含めた帽子の様子についての情報（誰から見ても最低1人は黒がいるとか,
帽子の個数は色ごとに同じではないなど）や,
他の囚人たちの推論の結果という情報などが必要になり,
ゆえに問題文も長くなるということです.

Hardin-Taylorの帽子パズルでは協力しているゆえに,
最低でも1人は正解するというような「囚人たちの勝利条件」というものが必要になり,
その部分ではDirac-Gardnerの帽子パズルよりは複雑になります.

2つのパズルでは帽子パズル特有の「見えない自分の帽子を色を推測する」という要素を持ちますが,
協力するか否かで,
囚人たちの正解者数に注目するか,
ここの囚人の推論の推移に注目するかという違いが生まれています.
そしてそれゆえにパズルを研究するさいの使用する学問分野も,
またパズルの結果の応用先の学問分野も変わってきます.

私の興味をもっている数学の分野は数理論理学・数学基礎論,
とくに公理的集合論であり,
この数学が応用できるのは囚人たちが協力するHardin-Taylorの帽子パズルだと考えています.
それは先行研究が既にそうなっているからだということに他なりませんが,
だからといってDirac-Gardnerの帽子パズルを調査対象から外すわけではありません.
なぜならば協力しない点は除いても,
それ以外の設定はHardin-Taylorの帽子パズルにも導入できることがあるからです.
またその逆もありえます.

上でも少し述べましたが,
各帽子パズルを構成する要素を,
今時点で私が知っている限り挙げてみます.
ここにない要素も,
私が新たなパズルを知ることで追加されるかもしれませんし,
協力・非協力以外の分類方法も生まれるかもしれません.

各要素の具体例を分かりやすくするために,
これまで登場したパズルではどうだったのかを以下の表のようにしてまとめてあります.

\begin{table}[H]
  \begin{center}
    \begin{tabular}{|c||cccc|}
       & \multicolumn{1}{c|}{Puzzle \ref{puzzle:hat-Hardin-Taylor}} & \multicolumn{1}{c|}{Puzzle \ref{puzzle:hat-Gardner-simultaneous}} & \multicolumn{1}{c|}{Puzzle \ref{puzzle:hat-Gardner-order}} & Puzzle \ref{puzzle:hat-Dirac} \\ \hline
      協力   & \multicolumn{1}{c|}{協力} & \multicolumn{3}{c|}{非協力} \\ \hline
      囚人数  & \multicolumn{1}{c|}{2人} & \multicolumn{3}{c|}{3人}  \\ \hline
      色の数  & \multicolumn{4}{c|}{2色}  \\ \hline
      帽子の見分け方  & \multicolumn{4}{c|}{色}  \\ \hline
      帽子を被せる個数  & \multicolumn{4}{c|}{1個}        \\ \hline
      帽子の見え方    & \multicolumn{4}{c|}{自分以外全員見える} \\ \hline
      帽子についての情報 & \multicolumn{1}{c|}{無} & \multicolumn{2}{c|}{有（誰からも黒が1つは見える）} & 有（白$\times 2$黒$\times 3$） \\ \hline
      発言方法   & \multicolumn{2}{c|}{全員同時} & \multicolumn{2}{c|}{1人ずつ順番に}  \\ \hline
      色以外の発言 & \multicolumn{1}{c|}{無}    & \multicolumn{3}{c|}{「分からない」も可能} \\\hline
      発言回数 & \multicolumn{1}{c|}{全員1回} & \multicolumn{3}{c|}{全員2度以上可能}  \\
    \end{tabular}
  \end{center}
\end{table}

要素の1つである囚人数を増やすと,
Hardin-Taylorの帽子パズルでの勝利条件の変更の考察をすることができます.
2人の囚人がプレイヤーであった\PuzzleRef{puzzle:hat-Hardin-Taylor}では,
囚人たちの勝利条件は最低でも1人が正解することでした.
このままでもたとえば勝利条件を「2人正解すること」にするとどうなるのか考察することができます.
これはのちに示す定理より不可能であると分かります.
そして3人にすると考察できる勝利条件に「3人正解すること」が増えます.
しかしこれ以外にもたとえば「全員が正解するか全員が不正解ならば囚人たちの勝利」や,
無限ならば「無限の囚人が正解し不正解者が有限ならば囚人たちの勝利」という,
単なる正解者数の数以外を求める勝利条件を考えることができます.
そしてDirac-Gardnerの帽子パズルでは囚人数や色数が増えても個々の囚人が自身の色を推測するようなものしかないと思われますが,
たとえば「自分に被せられていない色を言い当てる」というものもあります.
つまり個々の囚人の勝利条件を変えたものもあります.

よって「囚人たちが協力するかどうか」と以下のような要素をそれぞれ設定することで1つのパズルが生まれます.

$$
\begin{cases}
  \hspace{0.3cm}\text{囚人たちが協力する} \\
  \hspace{0.3cm}\text{囚人たちが協力しない}
\end{cases}
\times\hspace{0.7cm}
\begin{cases}
  \hspace{0.3cm}\text{囚人数} \\
  \hspace{0.3cm}\text{色の数} \\
  \hspace{0.3cm}\text{帽子の見分け方} \\
  \hspace{0.3cm}\text{帽子を被せる個数} \\
  \hspace{0.3cm}\text{帽子の見え方} \\
  \hspace{0.3cm}\text{帽子についての情報} \\
  \hspace{0.3cm}\text{発言方法} \\
  \hspace{0.3cm}\text{色以外の発言} \\
  \hspace{0.3cm}\text{発言回数} \\
  \hspace{0.3cm}\text{勝利条件}
\end{cases}
$$
\vspace{0.5cm}
ここからは各要素について具体例なども挙げながら,
さらにどのような多様なパズルが作成可能か見ていきます.

\end{document}
