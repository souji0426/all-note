\documentclass[C:/souji/all-note/note]{subfiles}

\begin{document}

帽子パズル・帽子パズルっぽいパズルには様々なバリエーションがあります.
今なお新しい設定のパズルが生まれている中で,
将来も見据えて網羅的にまとめることは難しいとは思いますが,
今時点での研究成果として,
帽子パズルがどのようなバリエーションが考えられるかまとめていきます.

他のバリエーションと比較するため,
前述した一番シンプルな帽子パズルを再掲します.
これと新しいバリエーションと比較して,
違いがよりわかりやすくなると思います.

\begin{re-puzzle}{puzzle:2人2色視野完全同時発言Hardin-Taylor帽子パズル}
  看守は釈放を望む2人の囚人に対して,
  これから行うあるゲームのルールについて説明しました.
  その内容は,
  \begin{enumerate}
    \item 囚人たちはこれからある部屋へ移動する.
    \item 部屋に入ってからは囚人たちは一切のコミュニケーションがとれない.
    \item その部屋には白黒に塗られた帽子がそれぞれ2つずつ置かれている.
    \item
      囚人1人に1つずつ,
      当人にはどの帽子か分からないようにしながらその帽子を被せる.
      また囚人たちはどの帽子を被せなかったのかも知ることはできない.
    \item
      囚人2人はそれぞれ自分が被っている帽子の色は分からないが,
      もう1人の囚人の帽子の色は見えている.
    \item
      帽子を被せられたあと,
      帽子の色のどちらかのみを,
      つまり「黒」か「白」のみを2人同時に発言させる.
    \item
    その発言とその被っている帽子の色が一致していれば正解となり,
    そんな正解者が1人でもいれば囚人たちの勝利として2人とも釈放される.
    もし2人とも不正解ならば囚人たちの敗北として2人とも処刑される.
  \end{enumerate}
  というものです.
  当たり前ですが看守が入室後どのように帽子を被せるかは,
  囚人たちには秘密です.
  このルールの説明を受けた後,
  ゲーム開始までに囚人たちには作戦を相談する十分な時間が与えられました.
  このとき入室後にどのように帽子を被せられても,
  囚人たちが勝利する作戦は存在するでしょうか？
\end{re-puzzle}

さっそく異なるタイプの帽子パズルを紹介します.

\begin{puzzle}[]
  \label{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}
  看守は3人の囚人に対して,
  これから行うあるゲームのルールについて説明しました.
  その内容は,
  \begin{enumerate}
    \item 囚人たちはこれからある部屋へ移動する.
    \item 入室後囚人たちは一切のコミュニケーションがとれない.
    \item その部屋には白黒に塗られた帽子がそれぞれ3つずつ置かれている.
    \item
      囚人1人に1つずつ,
      当人にはどの帽子か分からないようにしながらその帽子を被せる.
      また囚人たちはどの帽子を被せなかったのかも知ることはできない.
    \item
      どの囚人もそれぞれ自分が被っている帽子の色は分からないが,
      ほかの2人の囚人の帽子の色は見えている.
    \item 帽子を被せたあと他の全ての帽子を見てもらい黒色が1つでも見えたら手を挙げる.
    \item
      そのあと自分の色が何であるかを考えさせたあとに,
      全員同時に黒白どちらかの色か「分からない」のいずれかを発言させ,
      そのさい自分以外の発言は聞こえる.
    \item
      もし1人でも「分からない」と発言すれば,
      もう一度考えさせたあとに,
      同じように3択の中から発言させる.
      これを繰り返していき,
      その中で自分の帽子の色を言い当てることができれば,
      その囚人は釈放され,
      間違った色を発言すれば処刑される.
  \end{enumerate}
  というものです.
  当たり前ですが看守が入室後どのように帽子を被せるかは,
  囚人たちには秘密です.
  また囚人は正直なので自分の色が分かっているのに「分からない」とは発言しないものとします. \\
  ルール説明後,
  看守は囚人たちをその部屋へ移動させ,
  囚人全員に黒色の帽子を被せました.
  そしてルールに従って全員手を挙げました.
  そのあと全員が「分からない」と発言しました.
  しかしもう一度発言させると全員「黒」と発言し正解だったので釈放されました.
  なぜどの囚人も自分の色が分かったのでしょうか？
\end{puzzle}

\begin{answer}
  3人の囚人たちを$a,b,c$とおく.
  まず囚人$a$の立場にたって考えます.
  1回目の発言を終えたあと囚人$a$は自分が白色を被っていると考えると,
  見えている帽子の色とあわせて今自分たちの帽子の色の様子は以下のようになっていると考えるはずです.
  \vspace{-0.3cm}
  \begin{table}[H]
    \begin{center}
      \begin{tabular}{c|c|c}
            $a$ & $b$ & $c$ \\ \hline
            白    & 黒    & 黒
      \end{tabular}
    \end{center}
  \end{table}
  こういう被せ方でも最初に全員が手を挙げたことに矛盾はしません. \\
  そして囚人$a$は囚人$b$の立場にたって考えてみます.
  すると囚人$c$が手を挙げたことと,
  $b$からは$a$の白と$c$の黒が見えていることから,
  囚人$b$は自分が黒を被っているとわかるはずです.
  しかし1回目の発言で$b$は「分からない」と発言したことから,
  囚人$a$は自身が白色でない,
  つまり自分は黒色を被っていると分かり,
  2回目の発言で黒を発言して正解しました.
  $a$以外の囚人も1回目の発言後に同様に考えたことで自分が黒を被っていると分かりました.
\end{answer}

まず囚人たちに作戦があるかどうかを我々回答者に問うてきたPuzzle \ref{puzzle:2人2色視野完全同時発言Hardin-Taylor帽子パズル}とは,
問題の出題の仕方・出題内容が違うという点があります.
しかしそもそも囚人たちが挑むゲームの内容が変わっています.
それによって出題方法が変わっています.
なぜ出題方法まで変わったのかという考察についてはこの節の最後に行いますが,
今後さらに出題内容は変わっていくので,
それについては一旦気にせず進めていきます. \\

出題内容以外の,
囚人たちが挑むゲームの内容について注目して,
Puzzle \ref{puzzle:2人2色視野完全同時発言Hardin-Taylor帽子パズル}とPuzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}との違いをまとめてみると,
\begin{enumerate}
  \item 囚人が3人になっていること.
  \item 色以外に「分からない」という発言もできること.
  \item
    二度以上発言できることと,
    それによって1つ前の自分以外の発言という情報も,
    自身の色の推測に使うことができること.
  \item
    発言前に「黒が手を挙げさせる」というルールの追加と,
    それによって自分以外の囚人から見て黒が見えるかどうかを知ることができること.
\end{enumerate}
などがありますが,
私が考える最大の違いは,
囚人たちはチームでゲームに挑むのではなく,
あくまで個人で挑む点です.
なので入室前に作戦を相談するという行程が無くなっています.
詳しく説明すると,
Puzzle \ref{puzzle:2人2色視野完全同時発言Hardin-Taylor帽子パズル}では仮に自分が不正解だったとしても,
もう1人が正解すれば自分も助かります.
つまり個人個人の不正解はその囚人の処刑と直接は関係しません.
しかしPuzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}では,
個人の不正解は直接その囚人の処刑につながります.
この違いはこれから帽子パズルを分類するうえで最も大きな区分けになります. \\

続いてPuzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}を少し変形させたパズルを紹介します.
ゲームのルールにおいてPuzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}から変更した部分は,
テキストの色を変えて分かりやすくしています.

\begin{puzzle}[]
  \label{puzzle:個人戦3人2色視野完全順次発言全員同色帽子パズル}
  看守は3人の囚人（以下彼らを$a,b,c$とおく）に対して,
  これから行うあるゲームのルールについて説明しました.
  その内容は,
  \begin{enumerate}
    \item 囚人たちはこれからある部屋へ移動する.
    \item 入室後囚人たちは一切のコミュニケーションがとれない.
    \item その部屋には白黒に塗られた帽子がそれぞれ3つずつ置かれている.
    \item
      囚人1人に1つずつ,
      当人にはどの帽子か分からないようにしながらその帽子を被せる.
      また囚人たちはどの帽子を被せなかったのかも知ることはできない.
    \item
      どの囚人もそれぞれ自分が被っている帽子の色は分からないが,
      ほかの2人の囚人の帽子の色は見えている.
    \item 帽子を被せたあと他の全ての帽子を見てもらい黒色が1つでも見えたら手を挙げる.
    \item
      そのあと自分の色が何であるかを考えさせたあとに,
      {\color{red} $a,b,c$の順に}黒白どちらかの色か「分からない」のいずれかを発言させ,
      そのさい自分以外の発言は聞こえる.
    \item
      もし1人でも「分からない」と発言すれば,
      もう一度考えさせたあとに,
      同じように{\color{red} 再度$a,b,c$の順に}3択の中から発言させる.
      これを繰り返していき,
      その中で自分の帽子の色を言い当てることができれば,
      その囚人は釈放され,
      間違った色を発言すれば処刑される.
  \end{enumerate}
  というものです.
  当たり前ですが看守が入室後どのように帽子を被せるかは,
  囚人たちには秘密です.
  また囚人は正直なので自分の色が分かっているのに「分からない」とは発言しないものとします. \\
  ルール説明後,
  看守は囚人たちをその部屋へ移動させ,
  囚人全員に黒色の帽子を被せました.
  そしてルールに従って全員手を挙げました.
  最初の発言では3人は「分からない」と答えましたが,
  2度目の発言が回ってきた囚人$a$は「黒」と発言して正解し釈放されました.
  なぜ囚人$a$は自分の色が分かったのでしょうか？
\end{puzzle}

またこの後$b,c$も順に発言させていっても,
$a$と同じように考え発言することで,
Puzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}同様,
全員正解することができます.

Puzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}とPuzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}との違いは囚人たちの発言が全員同時ではなく順番になった点だけです.

もう1つ囚人たちが協力しないパズルの例を挙げます.
Puzzle \ref{puzzle:個人戦3人2色視野完全順次発言全員同色帽子パズル}をさらに変形させたものになります.
こちらもPuzzle \ref{puzzle:個人戦3人2色視野完全順次発言全員同色帽子パズル}との違いを分かりやすくするために,
Puzzle \ref{puzzle:個人戦3人2色視野完全順次発言全員同色帽子パズル}と異なる部分はテキストの色を変更しました.

\begin{puzzle}[]
  \label{puzzle:個人戦3人2色視野完全順次発言色配分不均衡帽子パズル}
  看守は3人の囚人（以下彼らを$a,b,c$とおく）に対して,
  これから行うあるゲームのルールについて説明しました.
  その内容は,
  \begin{enumerate}
    \item 囚人たちはこれからある部屋へ移動する.
    \item 入室後囚人たちは一切のコミュニケーションがとれない.
    \item
      {\color{red} その部屋には5つの帽子があり,
      うち2つは白色に,
      残り3つは黒色に塗られている}.
    \item
      囚人1人に1つずつ,
      当人にはどの帽子か分からないようにしながらその帽子を被せる.
      また囚人たちはどの帽子を被せなかったのかも知ることはできない.
    \item
      どの囚人もそれぞれ自分が被っている帽子の色は分からないが,
      ほかの2人の囚人の帽子の色は見えている.
    \item
      囚人たちにそれぞれ自分の色が何であるかを考えさせたあとに,
      {\color{red} $a,b,c$の順に}黒白どちらかの色か「分からない」のいずれかを発言させ,
      そのさい自分以外の発言は聞こえる.
    \item
      もし1人でも「分からない」と発言すれば,
      もう一度考えさせたあとに,
      同じように{\color{red} 再度$a,b,c$の順に}3択の中から発言させる.
      これを繰り返していき,
      その中で自分の帽子の色を言い当てることができれば,
      その囚人は釈放され,
      間違った色を発言すれば処刑される.
  \end{enumerate}
  というものです.
  当たり前ですが看守が入室後どのように帽子を被せるかは,
  囚人たちには秘密です.
  また囚人は正直なので自分の色が分かっているのに「分からない」とは発言しないものとします. \\
  ルール説明後,
  看守は囚人たちをその部屋へ移動させ,
  ルール通りに帽子を被せました.
  そのあと$a,b$は考えたのち順番に「分からない」と答えましたが,
  それを聞いた$c$は「黒」と発言して正解し釈放されました.
  なぜ囚人$c$は自分の色が分かったのでしょうか？
\end{puzzle}

\begin{answer}
  囚人$c$は,
  まず$a$が「分からない」と答えたことから$b$と自分の帽子の組み合わせの候補が以下のように絞れます.
  \vspace{-0.1cm}
  \begin{table}[H]
    \begin{center}
      \begin{tabular}{c|c}
            $b$ & $c$ \\ \hline
            黒    & 黒  \\
            黒    & 白  \\
            白    & 黒  \\
      \end{tabular}
    \end{center}
  \end{table}
  なぜならもし$b,c$がどちらも白を被っていれば,
  $a$は自分が黒だと分かったはずだからです.
  なのでその可能性は無くなり上記のような組み合わせだけが候補に残ります.
  またこれは$b$も同じことを考えつくことになります. \\
  続けて$b$も「分からない」と発言したことから,
  $c$は自分が黒だと分かります.
  なぜならば$b$も自分（$b$）と$c$は以下の組み合わせしかないと$a$の発言から分かっており,
  そしてもし$c$が白を被っていれば自分が黒を被っていると発言できたはずです.
  しかし分からないと答えたということは,
  $b$から見て$c$は黒を被っていたことになります.
\end{answer}

一見するとここまでのパズルとの違いに見えるのは,
私たち回答者には最後まで全ての囚人が何を被っているかは分からないという点と,
帽子の数が色ごとに決まっているという点でしょうか.
1点目はあくまで出題形式の違いです.
これについては前述した通り,
この節でのちに考察します.
2点目についてですが,
これまでのパズルのゲームでは,
色付きの帽子は各色それぞれ全囚人分用意されていました.
しかしこれはPuzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}とPuzzle \ref{puzzle:個人戦3人2色視野完全順次発言全員同色帽子パズル}と比べると,
実は大した違いではありません.
上記2つのパズルではそのゲームの中で黒が見えたら手を挙げさせるというものがありました.
そしてゲーム開始後に全員が手を挙げたことで,
どの囚人も誰から見ても1つは黒色帽子が見えていることが分かります.
つまり自分たちの帽子の被せ方として本来は$2^3=8$パターンの可能性があったわけですが,
黒が最低でも2つは被せられていることが分かり,
帽子の被せ方の可能性は4パターンにまで減少しています.
よってPuzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}とPuzzle \ref{puzzle:個人戦3人2色視野完全順次発言全員同色帽子パズル}の「発言前に黒が見えたら手を挙げる」というルールを無くし,
そもそも部屋には「帽子は黒色が3つ,
白色が1つだけある」という風にルールを変更することと同じことになるからです.
よってPuzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}・Puzzle \ref{puzzle:個人戦3人2色視野完全順次発言全員同色帽子パズル}・Puzzle \ref{puzzle:個人戦3人2色視野完全順次発言色配分不均衡帽子パズル}は,
帽子が全色囚人分用意されていないという点では同じであり,
異なるのはその色の配分だけということになります.
つまりPuzzle \ref{puzzle:2人2色視野完全同時発言Hardin-Taylor帽子パズル}と,
Puzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}・Puzzle \ref{puzzle:個人戦3人2色視野完全順次発言全員同色帽子パズル}・Puzzle \ref{puzzle:個人戦3人2色視野完全順次発言色配分不均衡帽子パズル}は,
各色の帽子が全囚人分用意されているか否かの視点でグループ分けすることができます.

さて,
このパズルにはこれまでとは異なる最大の違いがあります.
これまでのパズルでは自分以外の帽子が全て見えていました.
しかしPuzzle \ref{puzzle:個人戦3人2色視野完全順次発言色配分不均衡帽子パズル}はその解答を見れば分かる通り,
実は囚人$b$は$a$の,
囚人$c$は$a,b$の帽子が見えている必要がありません.
つまり$c$はどの発言が誰の発言なのか,
そして各囚人がどのように見えているのかさえ知っていれば,
部屋に入ったあとそれ以外に何も情報を得られなくとも正解することができます.

これらのパズルは説明しやすいように私なりに設定を変えていますが,
Puzzle \ref{puzzle:個人戦3人2色視野完全順次発言色配分不均衡帽子パズル}は物理学者の\textbf{Paul Dirac}が考案した可能性があり,
Puzzle \ref{puzzle:個人戦3人2色視野完全順次発言全員同色帽子パズル}はパズル作家でもあった数学者\textbf{Martin Gardner}がその著作にて紹介したものです.
この情報や証拠となる文献については\SecRef{section:帽子パズルの歴史}で紹介します.
上でも説明したとおりPuzzle \ref{puzzle:2人2色視野完全同時発言Hardin-Taylor帽子パズル}とこれら3つのパズルの最大の違いは,
囚人たちが協力するか・できるかという点にあると考えています.
よって囚人たちが協力する帽子パズルをこれまで通り\textbf{Hardin}-\textbf{Taylor}\textgt{の帽子パズル}と呼ぶことにし,
\index{しゅうじんとぼうしのぱずる@囚人と帽子のパズル!はーでぃんていらーのぼうしぱずる@Hardin-Taylorの帽子パズル}
新たに紹介した囚人たちが協力しない帽子パズルを2人の名前をとって,
\textbf{Dirac}-\textbf{Gardner}\textgt{の帽子パズル}と呼ぶことにしました.
\index{しゅうじんとぼうしのぱずる@囚人と帽子のパズル!でぃらっくがーどなーのぼうしぱずる@Dirac-Gardnerの帽子パズル}

よって私はすべての帽子パズルは囚人が協力するか否かで,
このHardin-Taylorのものか,
Dirac-Gardnerのものかに大別可能だと考えています.

Hardin-Taylorの帽子パズルの方がDirac-Gardnerの帽子パズルよりもシンプルだと感じます.
なぜならば後者では囚人は個人でゲームに挑んでおり,
自分以外の帽子が見えたところでそれだけでは自分の色を推測することは不可能なため,
追加の情報がいくつも必要になるからだと思います.
つまり自分も含めた帽子の様子についての情報（誰から見ても最低1人は黒がいるとか,
帽子の個数は色ごとに同じではないなど）や,
他の囚人たちの推論の結果という情報などが必要になり,
ゆえに問題文も長くなるということです.

Hardin-Taylorの帽子パズルでは協力しているゆえに,
最低でも1人は正解するというような「囚人たちの勝利条件」というものが必要になり,
その部分ではDirac-Gardnerの帽子パズルよりは複雑になります.

2つのパズルでは帽子パズル特有の「見えない自分の帽子を色を推測する」という要素を持ちますが,
協力するか否かで,
囚人たちの正解者数に注目するか,
ここの囚人の推論の推移に注目するかという違いが生まれています.
そしてそれゆえにパズルを研究するさいの使用する学問分野も,
またパズルの結果の応用先の学問分野も変わってきます.

私の興味をもっている数学の分野は数理論理学・数学基礎論,
とくに公理的集合論であり,
この数学が応用できるのは囚人たちが協力するHardin-Taylorの帽子パズルだと考えています.
それは先行研究が既にそうなっているからだということに他なりませんが,
だからといってDirac-Gardnerの帽子パズルを調査対象から外すわけではありません.
なぜならば協力しない点は除いても,
それ以外の設定はHardin-Taylorの帽子パズルにも導入できることがあるからです.
またその逆もありえます.

上でも少し述べましたが,
各帽子パズルを構成する要素を,
今時点で私が知っている限り挙げてみます.
ここにない要素も,
私が新たなパズルを知ることで追加されるかもしれませんし,
協力・非協力以外の分類方法も生まれるかもしれません.

各要素の具体例を分かりやすくするために,
これまで登場したパズルではどうだったのかを以下の表のようにしてまとめてあります.

\begin{table}[H]
  \begin{center}
    \begin{tabular}{|c||cccc|}
       & \multicolumn{1}{c|}{Puzzle \ref{puzzle:2人2色視野完全同時発言Hardin-Taylor帽子パズル}} & \multicolumn{1}{c|}{Puzzle \ref{puzzle:個人戦3人2色視野完全同時発言全員同色帽子パズル}} & \multicolumn{1}{c|}{Puzzle \ref{puzzle:個人戦3人2色視野完全順次発言全員同色帽子パズル}} & Puzzle \ref{puzzle:個人戦3人2色視野完全順次発言色配分不均衡帽子パズル} \\ \hline
      協力   & \multicolumn{1}{c|}{協力} & \multicolumn{3}{c|}{非協力} \\ \hline
      囚人数  & \multicolumn{1}{c|}{2人} & \multicolumn{3}{c|}{3人}  \\ \hline
      色の数  & \multicolumn{4}{c|}{2色}  \\ \hline
      帽子の見分け方  & \multicolumn{4}{c|}{色}  \\ \hline
      帽子に付く色の個数  & \multicolumn{4}{c|}{1個}        \\ \hline
      帽子の見え方    & \multicolumn{4}{c|}{自分以外全員見える} \\ \hline
      帽子についての情報 & \multicolumn{1}{c|}{黒白2つずつある} & \multicolumn{2}{c|}{有（誰からも黒が1つは見える）} & 有（白$\times 2$黒$\times 3$） \\ \hline
      発言方法   & \multicolumn{2}{c|}{全員同時} & \multicolumn{2}{c|}{1人ずつ順番に}  \\ \hline
      色以外の発言 & \multicolumn{1}{c|}{無}    & \multicolumn{3}{c|}{「分からない」も可能} \\\hline
      発言回数 & \multicolumn{1}{c|}{全員1回} & \multicolumn{3}{c|}{全員2度以上可能}  \\
    \end{tabular}
  \end{center}
\end{table}

例えば要素の1つである囚人数を増やすと,
Hardin-Taylorの帽子パズルでの勝利条件の変更の考察をすることができます.
2人の囚人がプレイヤーであった\PuzzleRef{puzzle:2人2色視野完全同時発言Hardin-Taylor帽子パズル}では,
囚人たちの勝利条件は最低でも1人が正解することでした.
このままでもたとえば勝利条件を「2人正解すること」にするとどうなるのか考察することができます.
これはのちに示す定理より不可能であると分かります.

%あとで書く
\begin{comment}
  有限パズルの平均正解者数定理が書けたら引用する
\end{comment}

このようにして人数を増やすだけでも様々な勝利条件が考察対象に加わります.
また単なる正解者の要求でない勝利条件も考案されています.
そしてDirac-Gardnerの帽子パズルでは囚人数や色数が増えても個々の囚人が自身の色を推測するようなものしかないと思われますが,
たとえば「自分に被せられていない色を言い当てる」というものもあります.
つまり個々の囚人の勝利条件を変えたものもあります.

よって「囚人たちが協力するかどうか」と以下のような要素をそれぞれ設定することで1つのパズルが生まれます.

$$
\begin{cases}
  \hspace{0.3cm}\text{囚人たちが協力する} \\
  \hspace{0.3cm}\text{囚人たちが協力しない}
\end{cases}
\times\hspace{0.7cm}
\begin{cases}
  \hspace{0.3cm}\text{囚人数} \\
  \hspace{0.3cm}\text{色の数} \\
  \hspace{0.3cm}\text{帽子の見分け方} \\
  \hspace{0.3cm}\text{帽子に付く色の個数} \\
  \hspace{0.3cm}\text{帽子の見え方} \\
  \hspace{0.3cm}\text{帽子についての情報} \\
  \hspace{0.3cm}\text{発言方法} \\
  \hspace{0.3cm}\text{色以外の発言} \\
  \hspace{0.3cm}\text{発言回数} \\
  \hspace{0.3cm}\text{勝利条件}
\end{cases}
$$
\vspace{0.5cm}
ここからは各要素について具体例なども挙げながら,
さらにどのような多様なパズルが作成可能か見ていきます.

\end{document}
