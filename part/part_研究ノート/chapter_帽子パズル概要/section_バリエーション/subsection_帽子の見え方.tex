\documentclass[C:/souji/all-note/note]{subfiles}

\begin{document}

ここまでに見てきたパズルは全て,
どの囚人も自分以外の全ての帽子が見えていた.
新たなバリエーションとしては,
何人かの囚人がいくつかの帽子を見えなくする,
というものです.
一般的に見えない帽子が増えるということは,
使える情報が減ることになるので,
見えなくなる帽子が増えるほど（そして他のルールは変えなければ）,
それだけ囚人は不利になります.

たとえばPuzzle \ref{puzzle:hat-Hardin-Taylor}を以下のように改造してみます.

\begin{puzzle}
  看守があるゲームをするために2人の囚人$a,b$を同じ部屋に入れ,
  帽子を1人に1つずつ被せます.
  その帽子は黒白どちらかの色で塗られています.
  {\color{red} 囚人$a$は$b$の帽子の色が分かりますが,
  囚人$b$は（目隠しするなどして）$a$の帽子の色は分かりません}.
  また部屋に入ってからは互いに一切のコミュニケーションが取れません.
  この状態で帽子の色のどちらかのみを,
  つまり「黒」か「白」のみを2人同時に発言させ,
  その発言とその発言者が被っている帽子の色が一致していれば正解となり,
  そんな正解者が1人でもいれば囚人側の勝利として2人とも釈放されます.
  もし2人とも不正解ならば囚人側の敗北として2人とも処刑されます.
  当たり前ですが看守がどのように帽子を被せるかは,
  囚人たちは入室するまで知りません.
  このゲームのルールや勝利条件については,
  部屋に入る前に囚人たちに伝えられ,
  ゲーム開始までに2人で戦略を相談することが可能です.
  このとき入室後にどのように帽子を被せられても,
  常に囚人側が勝利する戦略は存在するでしょうか？
\end{puzzle}

もともとのパズルでは囚人側に必勝戦略が存在しましたが,
このパズルでは存在しません.
つまり看守は囚人たちの作戦を知っていれば,
常に囚人2人ともが不正解になるように帽子を被せることができます.

\begin{answer}
  囚人$b$は部屋に入ってからとりうる行動は,
  常に黒と発言する,
  常に白と発言するのどちらかしかありません.
  テキトーにその時の囚人$b$の気分で黒白の好きな方を発言するというのは,
  論理的な行動でもないので2人の作戦には組み込めないとしておきます.
  ちなみに囚人たちの戦略を数学的に定義した場合でも,
  このような作戦は排除でき,
  このように何も見えていないような囚人は,
  決まられた色を発言するくらいしか行動できないということも分かります.
  これについては\SecRef{section:帽子パズルの形式化}を見てください. \\
  例えば囚人$b$は常に黒と発言するという行動をすることにしたとします.
  すると看守は$b$に白の帽子を被せることに決めます.
  そうすることで$b$は必ず不正解になります.
  すると囚人$a$がどのような作戦をとろうが,
  $b$の色が決まったことで$a$が何を発言するかも分かります.
  なので看守は$a$が発言しない方の色を被せれば$a$も不正解になります. \\
  つまり看守はそのように被せたときには2人とも間違えることになり,
  囚人たちは常に1人以上正解させることは不可能になります.
\end{answer}

Puzzle \ref{puzzle:hat-Hardin-Taylor}では囚人たちは看守に作戦がバレていても常に勝利することができましたが,
このパズルでは看守は上記の答えのようにして囚人たちが勝利しないようにすることができますし,
仮に作戦を知らなくてもたまたま上記の答えのように被せた場合でも囚人たちは敗北します.

さらに複雑な見え方をしているパズルは既にたくさん知られています.
Dirac-Gardnerの帽子パズルの例を1つあげます.

\begin{puzzle}
  看守があるゲームをするために3人の囚人$a,b,c,d$を同じ部屋に入れたあと,
  以下のルールを説明します.
  そのルールとは,
  \begin{enumerate}
    \item
      囚人$a,b,c$は一列に並べて,
      $a$は$b,c$の帽子のみが,
      $b$は$c$の帽子のみが,
      $c,d$はどちらも自分も含めてどの囚人の帽子も見えないように立たせる.
    \item
      4つある帽子のうち1つずつを囚人全員に被せていく.
      4つのうち2つは白色に,
      残り2つは黒色に塗られている.
    \item
      そのあと自分の色が何であるかを考えさせたあとに,
      $a,b,c,d$の順に黒白どちらかの色か「分からない」のいずれかを発言させ,
      そのさい自分以外の発言は聞こえる.
    \item
      もし1人でも「分からない」と発言すれば,
      もう一度考えさせたあとに,
      同じように再度$a,b,c,d$の順に３択の中から発言させる.
      これを繰り返していき,
      その中で自分の帽子の色を言い当てることができれば,
      その囚人は釈放され,
      間違った色を発言すれば処刑される.
  \end{enumerate}
  というものです.
  また囚人は自分の色が分かっているのに「分からない」とは発言しないものとします. \\
  まず$a$は「分からない」と答えましたが,
  それを聞いた$b$は自身の色を言い当てることができて釈放されました.
  なぜ囚人$c$は自分の色が分かったのでしょうか？
\end{puzzle}

\begin{figure}[htbp]
  \begin{center}
    \includegraphics[scale=0.8]{C:/souji/all-note/picture/階段＆壁あり帽子パズル.png}
    \caption{囚人の立ち位置のイメージ画像}
  \end{center}
\end{figure}

囚人たちは上の画像
\footnote{
  \url{http://nazo-nazo.com/sp/cat400/post-78.html}より入手.
}
のように立っていると考えられます.
$a,b,c$の見え方は階段上に下の段に向かって立っているように表現できます.
$d$は誰からも見えていないし誰の帽子も見えていないので,
画像のように目の前に壁があるように捉えることができます.

\begin{answer}
  囚人$a$はもし$b,c$を見て同じ色が2つ見えていれば,
  自身が何色を被っているか分かるはずです.
  しかし「分からない」と発言したことから$b,c$は黒白を1つずつ被っていると分かります.
  よって$c$が見えている$b$は,
  $c$が被っていない方の色を被っていると分かります.
\end{answer}

続いてHardin-Taylorの帽子パズルで例を1つ出します.

\begin{puzzle}
  \label{puzzle:hat-順次発言型例}
  看守があるゲームをするために3人の囚人$a,b,c,d$を同じ部屋に入れたあと,
  以下のルールを説明します.
  そのルールとは,
  \begin{enumerate}
    \item
      囚人$a,b,c,d$は一列に並べて,
      $a$は$b,c,d$の帽子のみが,
      $b$は$c,d$の帽子のみが,
      $d$は自分も含めてどの囚人の帽子も見えないように立たせる.
    \item
      各囚人に黒白どちらかの帽子を被せていく.
      この帽子はどちらも全囚人分あるとする.
    \item
      そのあと自分の色が何であるかを考えさせたあとに,
      $a,b,c,d$の順に黒白どちらかの色を発言させ,
      そのさい自分以外の発言は聞こえる.
    \item
      全囚人の発言が終わったあと,
      不正解者が1人以下,
      つまり3人以上が正解していれば囚人側の勝利として全員釈放される.
  \end{enumerate}
  というものです.
  当たり前ですが看守がどのように帽子を被せるかは,
  囚人たちは入室するまで知りません.
  このゲームのルールや勝利条件については,
  部屋に入る前に囚人たちに伝えられ,
  ゲーム開始までに4人で戦略を相談することが可能です.
  このとき入室後にどのように帽子を被せられても,
  常に囚人側が勝利する戦略は存在するでしょうか？
\end{puzzle}

このパズルでは1つ前のパズルの$a,b,c$のように4人が階段上に並んで立っていると捉えることができます.
この場合は$a$が最上段に,
$d$が最下段に立っていて,
ゆえに$d$は誰の帽子も見えていません.

このパズルは色の数は\PuzzleRef{puzzle:hat-Hardin-Taylor}と同じ2色ですが,
囚人の数は倍になっていて,
自分以外の帽子が全て見えていたPuzzle \ref{puzzle:hat-Hardin-Taylor}と比べれば,
$a$以外の囚人は多くの帽子が見えなくなっており,
$d$にいたっては何も見えていません.
一見かなり不利になっているように思えますが,
順番に発言しかつ自分以前の発言が聞こえることを活かせば,
Puzzle \ref{puzzle:hat-Hardin-Taylor}の最低1人以上という勝利条件よりもより不利な勝利条件「最低3人は正解する」というものでも,
必勝戦略が存在します.
それは以下のような作戦です.

\begin{answer}
  このゲームでは必勝戦略が存在します.
  まず囚人$a$は黒が奇数個見えたら黒と,
  偶数個見えたら白と発言するようにし,
  そのことを他の囚人にも教えておきます.
  囚人$b$はその発言を聞けば自分含めた囚人たちに被せられた帽子の黒の数の偶奇を知ることができます.
  そして見えている$c,d$の帽子の黒の数から自分が黒か白か判定することができます.
  そして囚人$c$は直前の$b$の発言が正解だったと仮定して（実際に正解していますが）,
  $b$と同じように自分含めた3人の囚人の黒の帽子の数の偶奇の情報と,
  $b$の発言と見えている$d$の色から自身の帽子の色が分かります.
  最後に$d$は直前2人の発言と$a$の発言から黒の帽子の数について考えれば,
  $d$も自身の色が分かります. \\
  黒の帽子の数は必ず偶数・奇数にどちらかになることから囚人$a$は必ずその個数を伝えることができ,
  そして$a$以外の囚人は上記のようにして必ず正解するため,
  この作戦は必勝になっています.
\end{answer}

つまり囚人$a$は他の囚人へ彼らのための情報を伝える役に徹することで,
残りの囚人が正解するようにする作戦です.
ただそのまま黒の偶奇を伝えることはできないので,
自分が発言できる色を使って,
その情報を暗号にするわけです.
囚人たちはその暗号の意味さえ分かっていれば,
上記のように正解することができます.
また別に黒の偶奇ではなく白の偶奇としても問題ありません.
より分かりやすいのは帽子を白黒という色ではなく,
$0,1$の数に置き換えて,
囚人$a$は$b,c,d$の帽子の数を合計し,
それを$2$で割った余り（必ず$0,1$どちらかになる）を発言する,
というものすることができます.
こちらの方が囚人にとっても覚えやすく間違えにくいと思われます.
まぁ帽子パズルでは囚人はどのような作戦もきっちり暗記でき,
ゲーム本番でも間違えることなく計算や判断をすることができると仮定されているわけですが.

上記の2つのパズルはどちらも発言に順番があるパズルでした.
この要素については\SecRef{subsection:発言方法}にて解説しますが,
発言を全員同時にしなくてはいけないパズルでも,
このような階段上に囚人が立っていると思えるようなパズルは考えることができます.

囚人が$a,b$という2人の場合は以下のような帽子の見え方の可能性があります.

\begin{enumerate}
  \item 2人とも互いに誰の帽子も見えていない.
  \item
    $a$は$b$の帽子が見えているが,
    $b$は$a$の帽子が見えない.
  \item
    $b$は$a$の帽子が見えているが,
    $a$は$b$の帽子が見えない.
  \item
    2人とも互いに相手の帽子が見えている.
\end{enumerate}

つまり2人という設定でもこれだけの見え方の候補があって,
それにあわせてまた別のパズルを作ることができます.

一般的に囚人が$n$人の場合は$2^{n(n-1)}$パターンの帽子の見え方があります.
この数だけ帽子パズルを考えることができるということです.
さらにこれらはグラフ理論の言葉を使うことでより効率良く考察しやすくなります.
それについては帽子パズルの用語を数学の言葉を使って定義していく,
\SecRef{section:帽子パズルの形式化}を見てください.

また囚人が無限にいる場合では,
帽子の見え方のパターンも無限に増えます.
そんな中でも特徴的なものを扱っていくとになります.
たとえば囚人が自然数と同じだけいる,
つまり各囚人に1つずつ自然数が割り振られているようなパズルにて,
\PuzzleRef{puzzle:hat-Hardin-Taylor}と同じように自分以外の帽子が全て見えているような設定とか,
自分より大きな番号を割り振られている囚人は全て見えて自分以下の番号の囚人は全て見えないような設定（これは階段上に並んでいるパズルの一般化です）とか,
さらに自分が奇数なら自分より大きな偶数だけ見える,
自分が偶数なら自分より大きな奇数だけが見えるなんて設定も考えることができます.
これらも日常言語ではなく数学の言葉を使うことで分かりやすくなると思います.
どのような無限帽子パズルがあるかについては,
無限帽子パズルの概略説明の節,
\SecRef{section:概略と節案内（無限帽子パズル）}に書くことにします.

\end{document}
