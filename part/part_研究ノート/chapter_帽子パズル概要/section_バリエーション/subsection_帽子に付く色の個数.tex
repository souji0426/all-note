\documentclass[C:/souji/all-note/note]{subfiles}

\begin{document}
\SecRef{subsection:帽子パズルの構成要素}で紹介した4つのパズルはどれも囚人たちに被せた帽子は色が1つだけ付いていました.

\begin{wrapfigure}{r}[0pt]{0.25\textwidth}
 \centering
   \includegraphics[scale=0.1]{C:/souji/all-note/picture/ウルトラマンっぽく体育帽を被る.png}
 \caption{いらすとや「紅白帽を縦にかぶった男の子のイラスト」}
\end{wrapfigure}

複数の色が付いているというのは右のようなイラスト
\footnote{
  \url{https://www.irasutoya.com/2020/08/blog-post_27.html}より入手.
}
が想像できます.
ただ2個よりも多いと,
もう帽子では考えにくくなりそうです.

これについてSmullyanはあるパズルを提案しています.
それは帽子を被るのではなく,
色付きのシールを複数枚額に貼るという設定のパズルです.
これだと個々の囚人に3色以上の色を対応させることも簡単に説明できそうです.
しかし無限枚,
いや十分に大きな枚数を貼るとなると,
シールで顔が埋め尽くされた囚人を想像することになるので,
そこは囚人の顔の表面積は無限になっているとしましょう.
Smullyanはそれまでの帽子パズルを拡張しようとしてこのパズルを考えたのかどうかは不明です.
Gardnerはその著作\cite{Puzzle004}にて,
Gardnerが考えていた帽子パズルの設定の曖昧さを排除できたものとしてこのパズルを紹介していました.
おそらく帽子が単色でないことには,
その書籍の中ではとくに注目していなかったのかもしれません.

\begin{puzzle}
  \label{puzzle:hat-Smullyan-two-per-person}
  看守があるゲームをするために3人の囚人$a,b,c$を同じ部屋に入れたあと,
  以下のルールを説明します.
  そのルールとは,
  \begin{enumerate}
    \item
      黒白のシールが4枚ずつある.
      全ての囚人の額に2枚ずつ貼っていく.
      自分がどの帽子を被っているのか知ることはできないが,
      自分以外の囚人がどのシールを付けているかは見える.
    \item
      そのあと自分に貼られた2つのシールの色が何であるかを考えさせたあとに,
      $a,b,c$の順に黒黒・黒白・白白か「分からない」のいずれかを発言させ,
      そのさい自分以外の発言は聞こえる.
    \item
      もし1人でも「分からない」と発言すれば,
      もう一度考えさせたあとに,
      同じように再度$a,b,c$の順に３択の中から発言させる.
      これを繰り返していき,
      その中で自分の帽子の色を言い当てることができれば,
      その囚人は釈放され,
      間違った色の組み合わせを発言すれば処刑される.
  \end{enumerate}
  というものです.
  また囚人は自分の色が分かっているのに「分からない」とは発言しないものとします. \\
  1回目の発言では$a,b,c$は順番に「分からない」と答え,
  そのあとさらに$a$は「分からない」と発言しました.
  そのあと囚人$b$は自分の色の組み合わせを言い当てることができました.
  なぜ囚人$b$は自分の色が分かったのでしょうか？
\end{puzzle}

\begin{answer}
  まず全員が1度発言した後とします.
  そして囚人$b$の立場にたって考えます.
  囚人$b$の額に貼ってあるシールの組み合わせは黒黒・黒白・白白のいずれかです.
  いま,
  囚人$b$は自身に黒黒とシールが貼ってあるとしてみます.
  そこから囚人$b$は$a$の立場に立って考えると,
  囚人$a$は自身の額には黒白と貼ってあると発言するはずだと考えます.
  \begin{sub-block}{{\boldmath $\because$}\,}
    囚人$a$は自身が黒黒だったと考えてみます.
    しかしそれならば$c$からは黒が4つ見えていることになるので,
    $c$は自身が白白であると分かるはずですが,
    $c$は1度目に「分からない」と発言していたので,
    囚人$a$は自身が黒黒ではないと分かります. \\
    次に囚人$a$は自身が白白だったと考えてみます.
    さらに囚人$c$に立場にたつと,
    もし囚人$c$が白白ならば,
    囚人$b$から見て白が4つ見えています.
    しかし囚人$b$が「分からない」と発言したことから,
    囚人$c$は自身が白白ではないと分かります.
    つまり囚人$c$は$a$と同じ理由で自身が黒黒でないとも分かっているはずなので,
    囚人$c$は白白でも黒黒でもないことから黒白だと分かるはずです.
    しかし囚人$c$は「分からない」と発言したことから,
    $a$は白白でないと分かります. \\
    よって残された候補から囚人$a$は自身が黒白しかないと分かります.
  \end{sub-block}
  しかし囚人$a$が2度目の機会で「分からない」と発言したことから,
  囚人$b$は自身は黒黒ではないと分かります. \\
  同様に囚人$b$が自身には白白と貼ってあると考えてみると,
  これも囚人$a$が2度目の機会で「分からない」と発言したことから,
  この貼り方ではないと分かります. \\
  よって残された可能性である黒白のみが残り,
  $b$は自身のシールの組み合わせが分かります.
\end{answer}

\cite{Puzzle004}に書いてある通り,
この問題は上記のような（ややこしい）推論をしなくても解くことができます.

\begin{answer}
  この問題では黒と白のシールの数は同じである.
  もし囚人$b$が自身の色が黒黒だと分かったのならば,
  黒黒だと分かった議論の中での白黒を反転させることで,
  白白も答えになるはずです.
  しかし$b$が一意な答えを見つけたことから黒黒も白白も候補から外れて,
  黒白だと分かったはずです.
\end{answer}

このパズルは非協力型のDirac-Gardnerの帽子パズルの拡張です.
しかし複数の帽子を被せるという設定だけでも,
協力型のHardin-Taylorの帽子パズルへ応用可能です.
Hardin-Taylorの帽子パズルにて,
各囚人に2つ以上の色付き帽子を被せる帽子パズルのことを,
考案者の名前をとって\textbf{Smullyan}\textgt{の帽子パズル}とよぶことにします.
\index{しゅうじんとぼうしのぱずる@囚人と帽子のパズル!すまりやんのぼうしぱずる@Smullyanの帽子パズル}
これについての考察は\SecRef{subsection:Smullyanの帽子パズル}ですることにします.
今のところはSmullyanの名前を使っていますが,
彼が別の彼由来らしきパズルを考案している可能性も高い（なにせ論理パズル多産者としても有名）ので,
そのようなパズルが見つかれば,
この名前は再考することにします.

\end{document}
